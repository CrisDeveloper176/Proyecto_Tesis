<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Vehículos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { margin-bottom: 20px; }
        label { display: block; margin: 5px 0; }
        input, select { margin-bottom: 10px; }
        button { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Gestión de Vehículos</h1>

    <!-- Crear Vehículo -->
    <h2>Crear Nuevo Vehículo</h2>
    <form id="createVehiculoForm" method="post" action="{% url 'create_vehiculo' %}">
        {% csrf_token %}
        <label for="patente">Patente:</label>
        <input type="text" id="patente" name="patente" required>

        <label for="marca">Marca:</label>
        <input type="text" id="marca" name="marca" required>

        <label for="modelo">Modelo:</label>
        <input type="text" id="modelo" name="modelo" required>

        <label for="anio">Año:</label>
        <input type="number" id="anio" name="anio" required>

        <label for="tipoVehiculo">Tipo de Vehículo:</label>
        <select id="tipoVehiculo" name="tipoVehiculo" required>
            {% for tipo in tipos_vehiculo %}
                <option value="{{ TipoVehiculo.CodTipo }}">{{ TipoVehiculo.nombreTipo }}</option>
            {% endfor %}
        </select>

        <label for="combustible">Combustibles:</label>
        <select id="combustible" name="combustible" multiple required>
            {% for combustible in combustibles %}
                <option value="{{ combustible.id }}">{{ combustible.nombre }}</option>
            {% endfor %}
        </select>

        <button type="submit">Crear Vehículo</button>
    </form>

    {% if success %}
        <p style="color:green;">Vehículo creado exitosamente.</p>
    {% elif error %}
        <p style="color:red;">Error al crear el vehículo: {{ error }}</p>
    {% endif %}

    <!-- Lista de Vehículos -->
    <h2>Lista de Vehículos</h2>
    <ul id="vehiculosList">
        {% for vehiculo in vehiculos %}
            <li id="vehiculo-{{ vehiculo.patente }}">
                {{ vehiculo.marca }} - {{ vehiculo.modelo }} ({{ vehiculo.patente }}) - {{ vehiculo.tipoVehiculo.nombre }}
                <button onclick="editVehiculo('{{ vehiculo.patente }}')">Editar</button>
                <button onclick="deleteVehiculo('{{ vehiculo.patente }}')">Eliminar</button>
            </li>
        {% endfor %}
    </ul>

    <!-- Actualizar Vehículo -->
    <h2>Actualizar Vehículo</h2>
    <form id="updateVehiculoForm" style="display: none;">
        <input type="hidden" id="updateVehiculoId" name="vehiculoId">
        <label for="updatePatente">Patente:</label>
        <input type="text" id="updatePatente" name="patente" required>

        <label for="updateMarca">Marca:</label>
        <input type="text" id="updateMarca" name="marca" required>

        <label for="updateModelo">Modelo:</label>
        <input type="text" id="updateModelo" name="modelo" required>

        <label for="updateAnio">Año:</label>
        <input type="number" id="updateAnio" name="anio" required>

        <label for="updateTipoVehiculo">Tipo de Vehículo:</label>
        <select id="updateTipoVehiculo" name="tipoVehiculo" required>
            {% for tipo in tipos_vehiculo %}
                <option value="{{ tipo.id }}">{{ tipo.nombre }}</option>
            {% endfor %}
        </select>

        <label for="updateCombustible">Combustibles:</label>
        <select id="updateCombustible" name="combustible" multiple required>
            {% for combustible in combustibles %}
                <option value="{{ combustible.id }}">{{ combustible.nombre }}</option>
            {% endfor %}
        </select>

        <button type="submit">Actualizar Vehículo</button>
    </form>

   
    <script>
        // Editar Vehículo
        function editVehiculo(id) {
            fetch(`http://api-url/vehiculos/${id}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('updateVehiculoId').value = data.id;
                    document.getElementById('updatePatente').value = data.patente;
                    document.getElementById('updateMarca').value = data.marca;
                    document.getElementById('updateModelo').value = data.modelo;
                    document.getElementById('updateAnio').value = data.anio;
                    document.getElementById('updateTipoVehiculo').value = data.tipoVehiculo;
                    document.getElementById('updateCombustible').value = data.combustible;

                    document.getElementById('updateVehiculoForm').style.display = 'block';
                })
                .catch(error => console.error('Error:', error));
        }

        // Eliminar Vehículo
        function deleteVehiculo(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este vehículo?')) {
                fetch(`http://api-url/vehiculos/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        document.getElementById(`vehiculo-${id}`).remove();
                    } else {
                        console.error('Error al eliminar el vehículo.');
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        }

        // Actualizar Vehículo
        document.getElementById('updateVehiculoForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const id = document.getElementById('updateVehiculoId').value;
            const data = {
                patente: document.getElementById('updatePatente').value,
                marca: document.getElementById('updateMarca').value,
                modelo: document.getElementById('updateModelo').value,
                anio: document.getElementById('updateAnio').value,
                tipoVehiculo: document.getElementById('updateTipoVehiculo').value,
                combustible: document.getElementById('updateCombustible').value
            };

            fetch(`http://api-url/vehiculos/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    location.reload(); // Recargar la página para ver los cambios
                } else {
                    console.error('Error al actualizar el vehículo.');
                }
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>

