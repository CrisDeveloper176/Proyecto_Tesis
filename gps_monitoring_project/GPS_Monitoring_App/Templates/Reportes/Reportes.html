{% extends 'TemplatesBase/Base.html' %}

{% block content %}
<div class="container">
    <h1 class="my-4 text-center">Reportes</h1>

<!-- Listar Arrendatarios -->
<h2 class="mt-4">Lista de Arrendatarios</h2>
<table class="table table-bordered table-striped">
    <thead class="table-dark">
        <tr>
            <th>ID Viaje</th>
            <th>Punto Origen</th>
            <th>Destino</th>
            <th>Fecha Inicio</th>
            <th>Fecha Fin</th>
            <th>Distancia Recorrida</th>
            <th>Velocidad Media</th>
            <th>ID Dispositivo GPS</th>
            <th>RUT</th>
        </tr>
    </thead>
    <tbody>
        {% if arrendatarios %}
            {% for arrendatario in arrendatarios %}
            <tr>
                <td>{{ arrendatario.ID_Viaje }}</td>
                <td>{{ arrendatario.Punto_Origen }}</td>
                <td>{{ arrendatario.Destino }}</td>
                <td>{{ arrendatario.Fecha_Inicio }}</td>
                <td>{{ arrendatario.Fecha_Fin }}</td>
                <td>{{ arrendatario.Distancia_Recorrida }}</td>
                <td>{{ arrendatario.Velocidad_Media }}</td>
                <td>{{ arrendatario.ID_DispositivoGPS }}</td>
                <td>{{ arrendatario.Rut }}</td>
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="9" class="text-center">No se encontraron arrendatarios.</td>
            </tr>
        {% endif %}
    </tbody>
</table>


    <!-- Vehículos -->
    <!-- Listar Vehículos -->
    <h2 class="mt-4">Lista de Vehículos</h2>
    <table id="tabla-vehiculos" class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Matrícula</th>
                <th>Estado</th>
                <th>Kilometraje</th>
                <th>Modelo</th>
            </tr>
        </thead>
        <tbody>
            <!-- El contenido de la tabla se cargará dinámicamente -->
        </tbody>
    </table>
    


    <!-- Mantenimiento -->
    <h2 class="mt-4">Lista de Mantenimiento</h2>
    <table id="tabla-mantenimiento" class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Fecha_Inicio</th>
                <th>Fecha_Fin</th>
                <th>ID_Vehiculo</th>
                <th>ID_Mantenimiento</th>
            </tr>
        </thead>
        <tbody>
            <!-- Las filas se cargarán dinámicamente -->
        </tbody>
    </table>
    
<script>
    // Ejemplo usando Fetch API para cargar datos
    document.addEventListener('DOMContentLoaded', () => {
    // Función para cargar datos en la tabla
    function cargarDatosVehiculos() {
        fetch('/reporte/obtener_vehiculos/', { 
            headers: { 'x-requested-with': 'XMLHttpRequest' } 
        })
        .then(response => response.json())
        .then(data => {
            const tbody = document.querySelector('#tabla-vehiculos tbody');
            tbody.innerHTML = ''; // Limpia las filas existentes

            if (data.vehiculos.length > 0) {
                data.vehiculos.forEach(vehiculo => {
                    const row = `
                        <tr>
                            <td>${vehiculo.ID_Vehiculo}</td>
                            <td>${vehiculo.Matricula}</td>
                            <td>${vehiculo.Estado_Vehiculo}</td>
                            <td>${vehiculo.kilometraje}</td>
                            <td>${vehiculo.modelo_nombre}</td>
                        </tr>`;
                    tbody.innerHTML += row;
                });
            } else {
                // Mostrar un mensaje si no hay vehículos
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">No se encontraron vehículos.</td>
                    </tr>`;
            }
        })
        .catch(error => console.error('Error al cargar los datos:', error));
    }

    // Llama a la función al cargar la página
    cargarDatosVehiculos();
});
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Función para cargar datos de mantenimiento en la tabla
        function cargarDatosMantenimiento() {
            fetch('/reporte/obtener_mantenimientos/', { 
                headers: { 'x-requested-with': 'XMLHttpRequest' }
            })
            .then(response => response.json())
            .then(data => {
                const tbody = document.querySelector('#tabla-mantenimiento tbody');
                tbody.innerHTML = ''; // Limpia las filas existentes

                if (data.mantenimiento && data.mantenimiento.length > 0) {
                    data.mantenimiento.forEach(mantenimiento => {
                        const row = `
                            <tr>
                                <td>${mantenimiento.ID_Mantenimiento}</td>
                                <td>${mantenimiento.Fecha_Mantenimiento}</td>
                                <td>${mantenimiento.Descripcion}</td>
                                <td>${mantenimiento.ID_Vehiculo}</td>
                            </tr>`;
                        tbody.innerHTML += row;
                    });
                } else {
                    // Mostrar un mensaje si no hay mantenimientos
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center">No se encontraron mantenimientos.</td>
                        </tr>`;
                }
            })
            .catch(error => console.error('Error al cargar los datos:', error));
        }

        // Llama a la función al cargar la página
        cargarDatosMantenimiento();
    });
</script>


{% endblock %}

